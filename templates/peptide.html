<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ESKtides</title>

    <!-- Modal -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

    <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="http://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>
    
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>

    <script type="text/javascript" src="https://cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css">
    <link rel="stylesheet" type="text/css" href="../static/css/eskape.css">
	
	
	<link rel="stylesheet" type="text/css" href="../static/css/phylotree.css">
	<script type="text/javascript" charset="utf8" src="../static/js/d3.v3.min.js"></script>
	<script type="text/javascript" charset="utf8" src="../static/js/underscore-min.js"></script>
	<script type="text/javascript" charset="utf8" src="../static/js/phylotree.js"></script>
</head>

<style type="text/css">
	.pace .pace-progress {
	  background: #1E92FB; /*进度条颜色*/
	  height: 3px;
	}
	.pace .pace-progress-inner {
	  box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
	}
	.pace .pace-activity {
	  border-top-color: #1E92FB;    /*上边框颜色*/
	  border-left-color: #1E92FB;    /*左边框颜色*/
	}

	#navbar a{
	  color: #FAFAFA;
	}
	div {
	  text-align: justify;
	}
</style>

<body>
<img src='../static/image/ESKtides.png'>
  <!--Navigator-->
  <nav class="navbar navbar-inverse navbar-static-top bg-dark">
    <div class="container">
      <div class="navbar-header">
           <a class="navbar-brand" href="/ESKtides">ESKtides</a>
		   
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <ul class="nav navbar-nav navbar-right collapse navbar-collapse">
        <li><a href="/ESKtides">Home</a></li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              Browse Genome<span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
              <li class="dropdown-header">ESKAPE strains</li>
              <li><a href="/strains1.html?strains=Staphylococcus_aureus">Staphylococcus aureus</a></li>
              <li><a href="/strains1.html?strains=Enterococcus_Faecium">Enterococcus Faecium</a></li>
              <li><a href="/strains1.html?strains=Klebsiella_pneumoniae">Klebsiella pneumoniae</a></li>
              <li><a href="/strains1.html?strains=Acinetobacter_baumannii">Acinetobacter baumannii</a></li>
			  <li><a href="/strains1.html?strains=Pseudomonas_aeruginosa">Pseudomonas aeruginosa</a></li>
			  <li><a href="/strains1.html?strains=Enterobacter_aerogenes">Enterobacter aerogenes</a></li>
			  <li><a href="/strains1.html?strains=Enterobacter_cloacae">Enterobacter cloacae</a></li>
			  <li><a href="/strains1.html?strains=Escherichia_coli">Escherichia coli</a></li>


              <li class="divider"></li>
              <li class="dropdown-header">ESKAPE phages</li>
			  <li><a href="/strains1.html?strains=Staphylococcus_aureus_phages">Staphylococcus aureus phages</a></li>
              <li><a href="/strains1.html?strains=Enterococcus_Faecium_phages">Enterococcus Faecium phages</a></li>
              <li><a href="/strains1.html?strains=Klebsiella_pneumoniae_phages">Klebsiella pneumoniae phages</a></li>
              <li><a href="/strains1.html?strains=Acinetobacter_baumannii_phages">Acinetobacter baumannii phages</a></li>
			  <li><a href="/strains1.html?strains=Pseudomonas_aeruginosa_phages">Pseudomonas aeruginosa phages</a></li>
			  <li><a href="/strains1.html?strains=Escherichia_coli_phages">Escherichia coli phages</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              Browse Peptides<span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
              <li class="dropdown-header">ESKAPE strains</li>
              <li><a href="/peptide.html?strains=Staphylococcus_aureus">Staphylococcus aureus</a></li>
              <li><a href="/peptide.html?strains=Enterococcus_Faecium">Enterococcus Faecium</a></li>
              <li><a href="/peptide.html?strains=Klebsiella_pneumoniae">Klebsiella pneumoniae</a></li>
              <li><a href="/peptide.html?strains=Acinetobacter_baumannii">Acinetobacter baumannii</a></li>
			  <li><a href="/peptide.html?strains=Pseudomonas_aeruginosa">Pseudomonas aeruginosa</a></li>
			  <li><a href="/peptide.html?strains=Enterobacter_aerogenes">Enterobacter aerogenes</a></li>
			  <li><a href="/peptide.html?strains=Enterobacter_cloacae">Enterobacter cloacae</a></li>
			  <li><a href="/peptide.html?strains=Escherichia_coli">Escherichia coli</a></li>


              <li class="divider"></li>
              <li class="dropdown-header">ESKAPE phages</li>
			  <li><a href="/peptide.html?strains=Staphylococcus_aureus_phages">Staphylococcus aureus phages</a></li>
              <li><a href="/peptide.html?strains=Enterococcus_Faecium_phages">Enterococcus Faecium phages</a></li>
              <li><a href="/peptide.html?strains=Klebsiella_pneumoniae_phages">Klebsiella pneumoniae phages</a></li>
              <li><a href="/peptide.html?strains=Acinetobacter_baumannii_phages">Acinetobacter baumannii phages</a></li>
			  <li><a href="/peptide.html?strains=Pseudomonas_aeruginosa_phages">Pseudomonas aeruginosa phages</a></li>
			  <li><a href="/peptide.html?strains=Escherichia_coli_phages">Escherichia coli phages</a></li>
          </ul>
        </li>
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              Analysis<span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                <li><a href="/predict.html">Peptides activity Prediction</a></li>
                <li><a href="/phylotree.html">Peptides Phylogenetic tree</a></li>
                <li><a href="/property.html">Physicochemical property</a></li>
            </ul>
        </li>
        <li><a href="/statistics.html">Statistics</a></li>
        <li><a href="/download.html">Download</a></li>
        <li><a href="/help.html">Help</a></li>
      </ul>
    </div>
  </nav>
<!-- Page Content-->
<style>
      .left {
        float: left;
        margin-left: 30px;
      }
      .right {
        margin-left: 570px;
      }
</style>
<div class="container">
  <div class = "well" style="font-size: 16px;">
   <h3 style="text-align:left">Peptides Informations</h3>
    <br>
   <p><i class = "fa fa-info-circle"></i>
       In this table,user can search and download active peptides for ESKAPE strains and phages
   </p>
   <hr>
   <div class="left">
       <img src="../static/image/peptide.png" style="width: 480px;height: 250px">
   </div>
   <div class="right">
       <img src="../static/image/peptide1.png" style="width: 480px">
   </div>
  </div>
</div>
<br>
<hr>
<!-- Page Content-->
<div class="container">
	<br>
    <h3 id='name' style="text-align:left"></h3>
	<br>
	<hr>
    <table border="0" cellspacing="5" cellpadding="5" height="130" style="float: left;margin: 0px;padding: 0px;">
        <tbody>
        <tr>
            <td><h4><strong>Minimum length:</strong></h4></td>
            <td><input type="text" id="min" name="min" value="6" size="50"></td>
        </tr>

        <tr>
            <td><h4><strong>Maximum length:</strong></h4></td>
            <td><input type="text" id="max" name="max" value="50" size="50"></td>
        </tr>
        </tbody>
    </table>
    <table border="0" cellspacing="5" cellpadding="5" height="130" style="float: right;margin: 0px;padding: 0px;">
        <tbody>
        <tr>
            <td><h4><strong>Minimum activity:</strong></h4></td>
            <td><input type="text" id="minact" name="minact" value="0.5" size="50"></td>
        </tr>
        <tr>
            <td ><h4><strong>Maximum activity:</strong></h4></td>
            <td><input type="text" id="maxact" name="maxact" value="1" size="50"></td>
        </tr>
        </tbody>
    </table>
</div>
<div class="container">
    <button type="button" onclick="select()">Select</button><strong> Click to filter</strong>
</div>
<br>
<br>
<div class="container">
    <table class="table table-bordered table-hover" id="peptides" width="100%">
        <thead>
            <tr>
                <th>Number</th>
                <th>ORFs ID</th>
                <th>Sequence</th>
                <th>Length</th>
                <th>Activity</th>
                <th>Level</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <h4 style="text-align:left">Sorry, the loading data is too large, please wait for about half a minute.</h4>
    <br>
    <br>
</div>

<!-- Footer-->
<footer class="py-5 bg-dark">
  <div class="container">
    <p class="m-0 text-center text-white">Firefox & Chrome recommended.<br />
      &copy; All rights reserved by <a target="_blank" href="https://lijinquanlab.github.io/index.html">Jinquan Li's Lab</a>, HZAU.</p>
  </div>
</footer>

<script type="text/javascript">
document.addEventListener('DOMContentLoaded',function(){//生命周期函数，注意顺序
      let url = window.location.href;
      let urlParams = url.split('?')[1]
      let obj = {}
      if(urlParams){
        let arr = urlParams.split('&');
        for(let i = 0; i < arr.length; i++) {
          let params = arr[i].split('=')
          obj[params[0]] = params[1]
        }
	  if(obj.strains.split('_')[2]=='phages'){
		var name = obj.strains.split('_')[0] + ' ' + obj.strains.split('_')[1] + ' ' + obj.strains.split('_')[2] + ' Peptides';
		console.log(name)
	  }
	  else{
		var name = obj.strains.split('_')[0] + ' ' + obj.strains.split('_')[1] + ' Peptides' ;
		console.log(name)
	  }	
    }
	$("#name").html(name);
},false);


var getseq = function(x){
    console.log(x);
    var seq = x.split(',')[0];
    var name = x.split(',')[1];

    var my_data = {
        "name":name,
        "seq":seq,
    };

     $.ajax({
              url: "http://127.0.0.1:5000/download_file/", //json文件位置
              type: "GET", //请求方式为get
              dataType: "",
              data: my_data,
              success: function (data) { //请求成功完成后要执行的方法
                  console.log(data);
                  if ($('#file').length > 0){
                      $("#file").remove();
                  }
                  var link = document.createElement('a');
                  console.log(link);
                  link.download = "peptide.fa";
                  link.href = data;
                  link.setAttribute('download', '');
                  link.setAttribute('id', 'file');
                  document.body.appendChild(link);
                  link.click();
              }
          })
};

function select(){
    var table = $('#peptides').DataTable({
    //"retrieve": true,
    "serverSide":true,
    "searching":true,
    "processing":true,
    "paging":true,
    "retrieve": true,
    //"bServerSide":true,
    //"bProcessing":true,
    //"bPaginate":true,
    "ordering":true,
    "lengthMenu": [15],
    ajax: {
        url: 'http://113.57.10.23:9000/tides/',
        type: "GET",
        data: function(d){// 添加额外的参数传递到后台
            var name = $('#name').text();
            var min = $('#min').val();
            var max = $('#max').val();
            var minact = $('#minact').val();
            var maxact = $('#maxact').val();
            d.extra_search = name + '=' + min + '=' + max + '=' + minact + '=' + maxact;
        }
    },
    dom:'Bfrtip',
    buttons:[
      'copy','csv','excel','pdf','print'
    ],
    "columns":[
      {'data':'Number'},
      {'data':'Peptide_ID'},
      {'data':'Seq',
          render: function(data, type, row) {
              return '<button onclick="getseq(\'' + row.Sequence + ',' +
                  row.Peptide_ID + '-length=' + row.Length + ',' + '\')">' + data + '</button>'; }
      },
      {'data':'Length'},
      {'data':'Activity'},
      {'data':'Level'}
    ],
});
    table.ajax.reload()
}

$(document).ready(function(){//生命周期函数，注意顺序
    var table = $('#peptides').DataTable({
        //"retrieve": true,
        "serverSide":true,
        "searching":true,
        "processing":true,
        "paging":true,
        //"bServerSide":true,
        //"bProcessing":true,
        //"bPaginate":true,
        "ordering":true,
        "lengthMenu": [15],
        ajax: {
            url: 'http://113.57.10.23:9000/tides/',
            type: "GET",
            data: function(d){// 添加额外的参数传递到后台
                 var name = $('#name').text();
                 var min = $('#min').val();
                 var max = $('#max').val();
                 var minact = $('#minact').val();
                 var maxact = $('#maxact').val();
                 d.extra_search = name + '=' + min + '=' + max + '=' + minact + '=' + maxact;
            }
        },
        dom:'Bfrtip',
        buttons:[
          'copy','csv','excel','pdf','print'
        ],
        "columns":[
          {'data':'Number'},
          {'data':'Peptide_ID'},
          {'data':'Seq',
              render: function(data, type, row) {
                  return '<button onclick="getseq(\'' + row.Sequence + ',' +
                      row.Peptide_ID + '-length=' + row.Length + ',' + '\')">' + data + '</button>'; }
          },
          {'data':'Length'},
          {'data':'Activity'},
          {'data':'Level'}
        ],
    });
});

</script>

</body> 
</html> 